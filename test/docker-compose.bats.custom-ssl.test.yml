version: '2'

services:

  sut:
    image: graze/bats
    command: /app/bats/custom-ssl.sh
    depends_on:
      - ispconfig
    networks:
      - test_shared
    environment:
      - HOSTNAME=test.com
      - SSL_CERT=/etc/ssl/local/test.com.crt
      - SSL_CHAIN=/etc/ssl/local/test.com.chain.pem
      - SSL_KEY=/etc/ssl/local/test.com.key
    volumes:
      - ./:/app:ro
      - ./ssl:/etc/ssl/local:ro
      - /var/run/docker.sock:/var/run/docker.sock

  ispconfig:
    extends:
      file: ../docker-compose.template.yml
      service: ispconfig
    networks:
      - test_shared
    environment:
      - SSL_CERT=/etc/ssl/local/test.com.crt
      - SSL_CHAIN=/etc/ssl/local/test.com.chain.pem
      - SSL_KEY=/etc/ssl/local/test.com.key
    volumes:
      - ./ssl:/etc/ssl/local:ro

networks:
  test_shared:
    external: true

