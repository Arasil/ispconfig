#!/bin/bash

PWFI=/etc/.mysql_root_pw

if [ "$1" = "" ] ; then
  echo "  # Configuration :"
  echo "  config mysql_root_pw <old-PW> <new-PW>           # change mysql root password"
  echo "  config panal_admin_pw <password>                 # set panel admin password"
  echo "  config server_name <FQDN>                        # set server name in database"
  exit 0
fi

if [ "$1" = "mysql_root_pw" ] ; then
  mysqladmin -uroot -p${2} password ${3}
  echo "MYSQL_ROOT_PW=\"$3\""  > $PWFI
  chmod og-rwx                   $PWFI
  chown root.root                $PWFI
  exit 0
fi

if [ ! -e "$PWFI" ] ; then
   echo "mysql root password not set in <$PWFI>. Please set it with mysql_root_pw first!"
   exit 0
fi

. $PWFI

if [ "$1" = "panal_admin_pw" ] ; then
  #echo "UPDATE sys_user SET passwort = md5(\"$2\") WHERE username = 'admin';" 
  #echo mysql -uroot -p${MYSQL_ROOT_PW} dbispconfig
  echo "UPDATE sys_user SET passwort = md5(\"$2\") WHERE username = 'admin';" | mysql -uroot -p${MYSQL_ROOT_PW} dbispconfig
  exit 0
fi   
if [ "$1" = "server_name" ] ; then
  echo "update server set server_name=\"$2\" ;"                   | mysql -uroot -p${MYSQL_ROOT_PW} dbispconfig
  exit 0
fi

