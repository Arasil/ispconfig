#!/bin/bash

if [ -f "$SSL_CHAIN" ] && [ -f "$SSL_KEY" ]; then
  echo " - configuring ssl certificate"

  SSL_CONF="/etc/dovecot/conf.d/10-ssl.conf"
  sed -i "s|ssl = .*|ssl = yes|" "$SSL_CONF"
  sed -i "s|#ssl_cert = .*|ssl_cert = <$SSL_CHAIN|" "$SSL_CONF"
  sed -i "s|#ssl_key = .*|ssl_key = <$SSL_KEY|" "$SSL_CONF"

  DOVECOT_CONF="/etc/dovecot/dovecot.conf"
  sed -i "s|ssl_cert = </etc/postfix/smtpd.cert|ssl_cert = |<$SSL_CHAIN|" "$DOVECOT_CONF"
  sed -i "s|ssl_key = </etc/postfix/smtpd.key|ssl_key = <$SSL_KEY|" "$DOVECOT_CONF"
fi
