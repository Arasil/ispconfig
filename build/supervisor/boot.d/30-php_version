#!/bin/bash -e

[ -z "$BUILD_PHP_VERS" ] && echo "\$BUILD_PHP_VERS not set!" && exit 1

FPM_SERVICE="/etc/supervisor/services.d/php$BUILD_PHP_VERS-fpm"
FPM_INIT="/etc/supervisor/init.d/php$BUILD_PHP_VERS-fpm"

[ -f "$FPM_INIT" ] || (echo "ERROR: Expected $FPM_INIT not found"; exit 1)
[ -f "$FPM_SERVICE" ] || (echo "ERROR: Expected $FPM_SERVICE not found"; exit 1)

[ "$({
  grep "php$BUILD_PHP_VERS-fpm" "$FPM_SERVICE"
  grep "php-fpm$BUILD_PHP_VERS" "$FPM_SERVICE"
} | wc -l)" == 2 ] \
  || (echo "ERROR: $FPM_SERVICE doesn't reference php$BUILD_PHP_VERS-fpm"; exit 1)
